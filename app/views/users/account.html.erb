<% @count = 0 %>
<% @user.tasks.each do |task| %>
  <% if task.status == "recent" %>
    <% @count = @count + 1 %>
  <% end %>
<% end %>

<!DOCTYPE html>
<html>
<title>Profile</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>

html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif}
</style>
<br>
<br>
<br>
<br>
<body class="#131c29">
  <!-- The Grid -->
  <div class="w3-row-padding">
    <!-- Left Column -->
    <div class="w3-third">
      <div id="posts">

        <div class="w3-display-container">
          <img src="http://seel.cse.lsu.edu/images/people/grant.png" style="width:100%">
          <div class="w3-display-bottomleft w3-container w3-text-black">
          </div>
        </div>
        <h2><b><font color="#E5E5E5">
          <% if @user.resume != nil %>
            <%= @user.resume.name %>
          <% end %>
        </font></b></h2>
        <div class="w3-container">

          <p><i class="fa fa-home fa-fw w3-margin-right w3-large w3-text-teal"></i>
            <% if @user.resume != nil %>
              <%= @user.resume.location %>
            <% end %>
          </p>
          <p><i class="fa fa-envelope fa-fw w3-margin-right w3-large w3-text-teal"></i><%= @user.email %></p>
          <p><i class="fa fa-phone fa-fw w3-margin-right w3-large w3-text-teal"></i>
            <% if @user.resume != nil %>
              <%= @user.resume.phone_number %>
            <% end %>
          </p>
            <% if @user == current_user %>
              <p><i class="fa fa-bars fa-fw w3-margin-right w3-large w3-text-teal"></i>
              <% if current_user.resume == nil %>
                <%= link_to "Create your resume", new_resume_path %>
              <% else %>
                <%= link_to "Edit Resume", edit_resume_path(current_user.resume) %>
              <% end %>
              </p>
            <% end %>
          <hr>

          <p class="w3-large"><b><i class="fa fa-asterisk fa-fw w3-margin-right w3-text-teal"></i>Skills</b></p>
          <% def find_percent(category, rating_cat) %>
            <% if rating_cat == nil %>
              <% rating_cat = 0 %>
            <% end %>
            <% @tasks = Task.where(:reviewed => true).where(:job_type => category).where(:user => @user) %>
            <% @total_task_rating = @tasks.length*5 %>
            <% if @total_task_rating == 0 %>
              <% @total_task_rating = 1 %>
            <% end %>
            <% @percent = ((rating_cat.to_f/@total_task_rating.to_f)*100).ceil %>
            <% if @percent == 0 %>
              <% @percent = "[No projects completed]" %>
            <% end %>
            <% @percent %>
          <% end %>

          <% @prog_percent = find_percent("Programming", @user.programming_rating) %>
          <p>Programming</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@prog_percent%>%">
              <div class="w3-center w3-text-white"><%=@prog_percent%>%</div>
            </div>
          </div>

          <% @music_percent = find_percent("Music", @user.music_rating) %>
          <p>Music</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@music_percent%>%">
              <div class="w3-center w3-text-white"><%=@music_percent%>%</div>
            </div>
          </div>

          <% @art_percent = find_percent("Art", @user.art_rating) %>
          <p>Art</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@art_percent%>%">
              <div class="w3-center w3-text-white"><%=@art_percent%>%</div>
            </div>
          </div>

          <% @story_percent = find_percent("Story", @user.story_rating) %>
          <p>Story</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@story_percent%>%">
              <div class="w3-center w3-text-white"><%=@story_percent%>%</div>
            </div>
          </div>

          <% @l_d_percent = find_percent("Level_Design", @user.level_design_rating) %>
    		  <p>Level Design</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@l_d_percent%>%">
              <div class="w3-center w3-text-white"><%=@l_d_percent%>%</div>
            </div>
          </div>

          <% @puzzles_percent = find_percent("Puzzles", @user.puzzles_rating) %>
    		  <p>Puzzles</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@puzzles_percent%>%">
              <div class="w3-center w3-text-white"><%=@puzzles_percent%>%</div>
            </div>
          </div>

          <% @misc_percent = find_percent("Miscellaneous", @user.misc_rating) %>
		      <p>Miscellaneous</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-teal" style="width:<%=@misc_percent%>%">
              <div class="w3-center w3-text-white"><%=@misc_percent%>%</div>
            </div>
          </div>
			<br>
        </div>
        </div>
      <br>
    <!-- End Left Column -->
    </div>
    <!-- Right Column -->
    <div class="w3-twothird">

      <div id="posts">
        <h2 class="w3-text-grey w3-padding-16"><i class="fa fa-certificate fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Bio</h2>

        <div class="w3-container">
          <p>
<!-- Leave this aligned to far left.  It needs to be like this for the formatting to work. -->
<pre><% if @user.resume != nil %>
<%= @user.resume.biography %>
<% end %></pre>
          </p>
          <hr>
        </div>
      </div>
      <br>
      <div id="posts">
              <h2 class="w3-text-grey w3-padding-16"><i class="fa fa-suitcase fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Completed Tasks (<%= @count %>)</h2>
                 <div style="overflow: auto; height: auto; max-height: 420px">
                  <br>
                  <% @user.tasks.each do |task| %>
                    <% if task.status == "recent" %>
                      <div class="w3-container">
                        <h5 class="w3-opacity"><b><%= link_to task.title, task %> ( <%= link_to task.project.name, task.project %> ) - <%= task.job_type %></b></h5>
                        <p><%= task.description %></p>
                        <hr>
                      </div>
                      <br>
                    <% end %>
                  <% end %>
                  </div>
      </div>
      <br>
<br>
    <!-- End Right Column -->
    </div>
  <!-- End Grid -->
  </div>
  <% if @user == current_user %>
      <div style="background:#192231; border-radius:5px; padding:10px;">
       Liked Posts:
        <br>
      <div style="overflow: auto; height: auto; max-height: 420px">
        <% Post.all.each do |post| %>
          <% if current_user.voted_up_for? post %>
          <div class="post">
            <div style="display: inline-block; padding-left: 20px">
            <h3 class="title">
              <%= link_to post.title, post %>
            </h3>
            <p class="date">
              Published
              <%= time_ago_in_words(post.created_at) %>
              ago by
              <%= link_to post.user.email, user_resume_search_path(post.user) %>
            </p>
            </div>
          </div>
          <% end %>
        <% end %>
        </div>
       </div>
      <br>
        <div style="background:#192231; border-radius:5px; padding:10px;">
         Current Tasks:
          <br>
          <% current_user.tasks.each do |task| %>
            <% if task.status == "inProg" %>
              > <%= link_to task.title, task %> ( <%= link_to task.project.name, task.project %> ) - <%= task.job_type %>
              <br>
            <% end %>
          <% end %>
        </div>
    <% end %>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
</body>
</html>
<style>
   pre {
      overflow-x: auto;
      white-space: pre-wrap;
      white-space: -moz-pre-wrap;
      white-space: -pre-wrap;
      white-space: -o-pre-wrap;
      word-wrap: break-word;
   }
</style>
